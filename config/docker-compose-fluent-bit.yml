version: '3.8'

services:
  fluent-bit:
    image: fluent/fluent-bit:latest
    container_name: fluent-bit
    restart: unless-stopped
    volumes:
      - ./fluent-bit/fluent-bit.conf:/fluent-bit/etc/fluent-bit.conf:ro
      - ./fluent-bit/parsers.conf:/fluent-bit/etc/parsers.conf:ro
      - /var/log:/var/log:ro
      - /var/lib/docker/containers:/var/lib/docker/containers:ro
      - ../logs/fluent-bit:/fluent-bit-output
      - /run/journal:/run/journal:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
    ports:
      - "8888:8888"
    command:
      - /fluent-bit/bin/fluent-bit
      - -c
      - /fluent-bit/etc/fluent-bit.conf
    networks:
      - healing-network
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    healthcheck:
      test: ["CMD", "pgrep", "fluent-bit"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  healing-network:
    external: true

